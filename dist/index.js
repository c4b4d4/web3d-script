var t={};(()=>{t.d=(e,s)=>{for(var i in s){if(t.o(s,i)&&!t.o(e,i)){Object.defineProperty(e,i,{enumerable:true,get:s[i]})}}}})();(()=>{t.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e)})();if(typeof t!=="undefined")t.ab=new URL(".",import.meta.url).pathname.slice(import.meta.url.match(/^file:\/\/\/\w:/)?1:0,-1)+"/";var e={};t.d(e,{N:()=>o});const guid=()=>{const s4=()=>Math.floor((1+Math.random())*65536).toString(16).substring(1);return(s4()+s4()+"-"+s4()+"-"+s4()+"-"+s4()+"-"+s4()+s4()+s4()+"-"+Math.round((new Date).getTime())).toUpperCase()};class Base{constructor(t){this.killed=false;this.listeners={};this.timers={};this.timerGroups={};this.id=t&&t.id?t.id:guid()+"-"+guid()+"-"+guid();this._postconstructor.bind(this)(t,this)}emit(t,...e){if(!e){e=false}let s=[];if(this.listeners[t]){for(const i in this.listeners[t]){for(const r in this.listeners[t][i]){const n=this.listeners[t][i][r].cb(...e);s.push(n);if(n&&n.stopPropagation){return s}}}}return s}interval(t,e,s){if(this.timers[t.id]){this.timers[t.id].destroy()}if(!s||typeof t=="string"||(t.id||t.group)){if(!s){s=e;e=t;t={}}if(typeof t=="string")t={id:t};if(!t.id)t.id=guid();if(!t.group)t.group="general"}let i=setInterval(e,s);if(!this.timerGroups[t.group])this.timerGroups[t.group]={};this.timerGroups[t.group][t.id]=true;this.timers[t.id]={group:t.group,timer:i,destroy:()=>{clearInterval(i);if(this.timerGroups[t.group]){delete this.timerGroups[t.group][t.id];if(Object.keys(this.timerGroups[t.group]).length==0){delete this.timerGroups[t.group]}}}};return this.timers[t.id]}async on(t,e,i,r,n){if(typeof t=="string"){n=r;r=i;i=e;e=t;t=s}if(!n){n=0}if(t.holder&&t.holder.on)t=t.holder;if(typeof i=="function"){r=i;i=guid()}let o=t.id;if(!this.listeners[e])this.listeners[e]={};if(!this.listeners[e][o])this.listeners[e][o]={};this.listeners[e][o][i]={instance:t,cb:r};if(n<2){await t.on(this,"kill","defaultkill_"+this.id+"_"+e+"_"+i,(()=>{this.off(t,e,i,true)}),n+1)}await this._attached(e,t);return{deattach:()=>{this.off(t,e,i)}}}async off(t,e,i,r){if(typeof t=="string"){ignoreAtt=cb;cb=i;i=e;e=t;t=s}if(!i){return}if(t.holder&&t.holder.on)t=t.holder;let n=t.id;if(this.listeners[e]&&this.listeners[e][n]&&this.listeners[e][n][i]){this.listeners[e][n][i]=false;delete this.listeners[e][n][i];if(Object.keys(this.listeners[e][n]).length==0){this.listeners[e][n]=false;delete this.listeners[e][n]}if(Object.keys(this.listeners[e]).length==0){this.listeners[e]=false;delete this.listeners[e]}}if(!r){await t.off(this,"kill","defaultkill_"+this.id+"_"+e+"_"+i,true)}await this._deattached(e,t)}kill(){if(this.killed)return;if(this._kill)this._kill();this.killed=true;for(const t in this.timers){this.timers[t].destroy()}for(const t in this.listeners){for(const e in this.listeners[t]){for(const s in this.listeners[t][e]){if(t=="kill"){this.listeners[t][e][s].cb()}const i=this.listeners[t][e][s];if(i&&i.instance){i.instance.off(this,"kill",this.id+"_"+t+"_"+s)}}}}this.listeners={}}async _attached(t,e){}async _deattached(t,e){}_kill(){}_postconstructor(t){}}const s=new Base;class Messenger extends Base{ready(){}_postconstructor(t){}}const i=new Messenger;const r=i;window.messenger=i;class Interpreter extends Base{attach(){r.ready()}_postconstructor(t){}}const n=Interpreter;const o=new n;var l=e.N;export{l as Interpreter};